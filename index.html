<link rel="stylesheet"
type="text/css" href="style/container.css" />
<script src="js/jquery.js"></script>
<script src="js/map.js"></script>
<script src="js/container.js"></script>
<script type="text/javascript" src="js/jquery.js"></script>
<script>$.ajaxSetup({ cache: true });</script>
<script type="text/javascript" src="js/map.js"></script>
<script type="text/javascript" src="js/three.min.js"></script>
<script>$.ajaxSetup({ cache: true });</script>
<!--<script type="text/javascript" src="js/physi.js"></script>
<script type="text/javascript" src="js/canvas_to_map.js"></script>
<script type="text/javascript" src="js/game.js"></script>-->
<body>
<div id="menu_container"></div>
<script>
    var container = new Container(
    "#menu_container", function(container) {
        container.addImage("img/logo.png");
        container.render();
        setTimeout(function()
        {
            $.getJSON("settings.json",
            function(settings, textStatus, jqXHR)
            {
                container.settings = settings;
                container.clear();
                container.addSection("Levels", function(section) {
                    var levels = new Levels();
                    levels.each(function(levelName, levelId) {
                        section.addButton(levelName,
                        function(value) {
                            container.pushState().clear();
                            container.addSection(levelName,
                            function(section) {
                            levels.open(levelId, function(level) {
                                for(var i in level.game) {
                                    section.addButton(i,
                                    function(val)
                                    {
                                        var game = level.game[val];
                                        container.pushState().clear();
                                        container.include('game.html',
                                        {
                                            storage:
                                            game.map.storage,
                                            name: game.map.name,
                                        });
                                    });
                        }
                        container.render(); })});
                        });
                        container.render();
                    });
                });
                var a = {
                    "Your Maps": "localStorage"};
                for(var name in a) {
                    container.addSection(name, function(section) {
                        var storage_type = a[name];
                        MapsFactory(storage_type).list(
                        function(list) {
                            for(i in list) {
                                section.addButton(list[i],
                                function(value) {
                                    container.pushState().clear();
                                    container.include('game.html',
                                    {
                                        storage: storage_type,
                                        name: value,
                                    });
                                });
                                container.render();
                            }
                    }) });
                }
                container.addSection("Tools", function(section) {
                    section.addButton("Editor",
                    function(value) {
                        container.pushState()
                        .clear().include('editor.html');
                    });
                    section.addButton("Settings",
                    function(value) {
                        container.pushState().clear();
                        for(var i in container.settings)
                        {
                            container.addSection(container.settings[i].name,
                            function(section){
                                for(var j in container.settings[i].value)
                                {
                                    var control = container.settings[i].value[j];
                                    if(control.kind == "toggle")
                                    {
                                        section.addToggle(control.value,
                                        control.text_on,
                                        control.text_off,
                                        function(state) {
                                            control.value = state;
                                        });
                                    }
                                }
                            });
                        }
                        container.render();
                    });
                })
                container.addLink(
                "https://github.com/yazgoo/nails_n_wood",
                "about");
            });
        }, 3000);
    });
</script>
</body>
